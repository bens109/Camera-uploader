<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Drive Upload Test</title>
</head>
<body>
  <input type="file" id="fileInput" accept="image/*">
  <button id="uploadBtn">Upload</button>
  <p id="status"></p>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzXgRlQJFiJHwYu-fZlM7kToSlM3u80s1TaW3QBK1ld6NIuimt2nzfPNh4QwrCZVEwzqw/exec";

    document.getElementById('uploadBtn').addEventListener('click', async () => {
      const file = document.getElementById('fileInput').files[0];
      if (!file) return alert("Select a file first");

      document.getElementById('status').textContent = "Uploading...";

      const base64 = await toBase64(file);
      const payload = {
        fileName: file.name,
        mimeType: file.type,
        file: base64
      };

      try {
        const res = await fetch(SCRIPT_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        document.getElementById('status').innerHTML =
          data.status === "success"
            ? `✅ Uploaded: <a href="${data.fileUrl}" target="_blank">${data.fileName}</a>`
            : `❌ Error: ${data.message}`;
      } catch (err) {
        document.getElementById('status').textContent = "❌ Upload failed: " + err.message;
      }
    });

    function toBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result.split(',')[1]);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }
  </script>
</body>
</html>
